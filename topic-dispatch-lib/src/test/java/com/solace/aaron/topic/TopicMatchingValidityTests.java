/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package com.solace.aaron.topic;

import java.util.HashSet;
import java.util.Set;
import java.util.regex.Pattern;

import org.junit.BeforeClass;
import org.junit.Test;

import com.solace.aaron.topic.utils.TestDataGeneratorUtil;

import dev.solace.aaron.topic.TopicUtil;

/** Compares the results of topic matching of both regular and regex subs */
public class TopicMatchingValidityTests {
	    
	static Set<String> topics = new HashSet<>();
	static Set<String> validSubs = new HashSet<>();
	
	@BeforeClass
	public static void populateData() {
		for (int i=0; i<10_000; i++) {
			String sub = TestDataGeneratorUtil.buildRandomSub(12);
			if (TopicUtil.validateSub(sub)) validSubs.add(sub);
		}
		for (int i=0; i<10_000; i++) {
			topics.add(TestDataGeneratorUtil.buildRandomTopic(20));
		}
	}
	
    @Test
    public void topicMatchingValidation() {
    	for (String sub : validSubs) {
    		for (String topic : topics) {
    			Pattern p = TopicUtil.buildSubRegexPattern(sub);
    			if (TopicUtil.topicMatches(topic, sub) ^ TopicUtil.topicMatchesRegex(topic, p)) {
    				System.out.println("Sub: " + sub + ", Topic: " + topic);
    				System.out.println(TopicUtil.topicMatches(topic, sub));
    				System.out.println(TopicUtil.buildSubRegex(sub));
    				System.out.println();
    			}
    		}
    	}
    }

}
